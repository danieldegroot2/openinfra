---
title: "SOTM 2022 Workshop - OSM for sustainable transport planning: getting started"
author: "James Hulse"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{SOTM2022 Workshop - OSM for sustainable transport planning: getting started}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

The [workshop](https://2022.stateofthemap.org/sessions/JEXYHK/) is aimed at everyone interested in using OpenStreetMap (OSM) to support sustainable transport planning, in professional or advocacy contexts through recategorisation of OpenStreetMap (OSM) transport infrastructure data. The focus will be on getting started, identifying, visualizing, and analyzing key tags and identifying gaps in walking, cycling, and wheeling networks. Participants will place OSM data in the context of other data sources to identify its unique advantages.

The workshop is designed to be practical and covers the following question:

1.  What gaps in transport evidence can OSM data fill in different countries?
2.  Which elements and tags are most important for transport planning (and how to get the data in reproducible data science environments)?
3.  How to filter based on different tags and their values?
4.  How to use OSM datasets to visualize transport systems in static and interactive maps?
5.  How to add value to OSM data and communicate results using R, Python and A/B Street, and osm2streets?

In order to take the most out of the workshop, we recommend to install R, RStudio, and the required packages before the session. To do this, follow "Installation" section below. Moreover, to make sure that everything is installed correctly and you're ready to go -- run a chunk of code in the "Installation Check" section! Check [this issue on GitHub](https://github.com/udsleeds/openinfra/issues/98) (you will need an account to make use of it) to find out what you should get after running that code or, alternatively, let us know if you have not :)

```{=html}
<!-- This workshop covers: 
* How to download and get OSM data from the R package `osmextract`
* Basics on how the `osmextract` package works
* How to visualise different types of network infrastructure
* How to add value to OSM infrastructure data through the `openinfra` package -->
```
## Installation

### Installing R and RStudio

This workshop will be carried out using R. If you are new to R, you should install base R and RStudio before the workshop begins. <br> There is a great [R and RStudio installation guide](https://rstudio-education.github.io/hopr/starting.html) (Section A.1) by Garrett Grolemund, within [Hands-On Programming with R](https://rstudio-education.github.io/hopr/) for Windows, Mac, and Linux devices.

### Installing Packages

A number of packages will be used within this workshop, though namely [`osmextract`](https://github.com/ropensci/osmextract) and [openinfra](https://github.com/udsleeds/openinfra).

Here are some of the additional packages we will make use of within this workshop:

```{r install_dep, eval = F}
pkgs = c("tmap",
         "sf",
         "dplyr",
         "remotes"
         )
```

These can be installed with:

```{r install_okgs, message=FALSE, eval = F}
install.packages(pkgs, repos = "http://cran.us.r-project.org")
```

You can install the development versions of the `osmextract` and `openinfra` packages as follows:

```{r install_dev, message=FALSE, eval = F}
# Enter the lines below into your console to install!
remotes::install_github("ropensci/osmextract")
remotes::install_github("udsleeds/openinfra")
```

Each package can then be loaded iteratively with `library(tmap)`, `library(sf)`, etc, or all at once with:

```{r load_pkgs, message=FALSE, eval = F}
pkgs = c(pkgs, "osmextract", "openinfra")
lapply(pkgs, library, character.only = TRUE)[length(pkgs)]
```

### Installation Check

If installation has occurred correctly, running the code below locally (on your own device) should successfully create two plots: <br> One 5km radius circular buffer of the infrastructure network around Leeds (UK) City Centre, and <br> Secondly, a test plot just outside of the Institute of Transport Studies (ITS), at the University of Leeds.

```{r install_check, message=FALSE, dpi=300, out.width = '100%', eval = F}
# Pre-installed package data
# data = sotm_data
# Test osmextract file (ITS Leeds = Institute of Transport Studies, Leeds.)
test_data = osmextract::oe_get(place = "ITS Leeds")

tmap::tm_shape(data |> dplyr::select("highway")) + 
  tmap::tm_lines(col = "highway", title.col = "OSM Highways") + 
  tmap::tm_layout( legend.bg.alpha = 0.5, legend.bg.color = "white")

tmap::tm_shape(test_data |> dplyr::select("highway")) + 
  tmap::tm_lines(col = "highway", title.col = "OSM Highways") + 
  tmap::tm_layout( legend.bg.alpha = 0.5, legend.bg.color = "white" )
```

## Why these packages?

The [`osmextract`](https://github.com/ropensci/osmextract) package is an open-source project, which allows for fast downloading and importing of OSM infrastructure data from one of three OSM providers. We can view all `osmextract` available providers with the following:

```{r show_providers, message=FALSE, eval = F}
osmextract::oe_providers() 
```

<br> `osmextract` uses [Geofabrik](http://download.geofabrik.de/), [BBBike](https://download.bbbike.org/osm/), and [openstreetmap_fr](https://download.openstreetmap.fr/extracts/) as OSM data providers. These providers extract, select, and process geospatial data from OSM in .osm.pbf file format. The .pbf file format results in much faster read/write times and reduces filesizes, more information can be found on the [OSM wiki](https://wiki.openstreetmap.org/wiki/PBF_Format). <br><br> The [openinfra](https://github.com/udsleeds/openinfra) package, another open-source project, contains several functions that recategorises OSM infrastructure data from the default key=tag values to friendlier visuals.

### osmextract

## The osmextract package works in the following way:
